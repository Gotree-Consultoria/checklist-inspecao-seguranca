<section class="documents-page page">
	<div class="container">
		<h1 class="page-title">Gerenciar Documentos</h1>

		<div class="filter-section">
			<div class="filter-row">
				<div class="filter-group small">
					<label for="type-filter" class="filter-label">Tipo</label>
					<select id="type-filter" class="filter-select" [(ngModel)]="filters.type" (change)="loadDocumentsList()">
						<option value="">Todos</option>
						<option value="visit">Relatório de Visita</option>
						<option value="aep">Avaliação Ergonômica</option>
						<option value="risk">Checklist de Riscos</option>
					</select>
				</div>

				<div class="filter-group search-group">
					<label for="client-filter" class="filter-label">Empresa/Cliente</label>
					<input type="text" id="client-filter" class="filter-input" [(ngModel)]="filters.clientName" placeholder="Nome da empresa...">
				</div>

				<div class="filter-group small">
					<label for="start-date-filter" class="filter-label">Data Inicial</label>
					<input type="date" id="start-date-filter" class="filter-input" [(ngModel)]="filters.startDate">
				</div>

				<div class="filter-group small">
					<label for="end-date-filter" class="filter-label">Data Final</label>
					<input type="date" id="end-date-filter" class="filter-input" [(ngModel)]="filters.endDate">
				</div>

				<div class="filter-actions">
					<button id="documentsFilterBtn" class="btn-filter" (click)="loadDocumentsList()">Pesquisar</button>
					<button class="btn-clear" (click)="resetFilters()">Limpar</button>
				</div>
			</div>

			<!-- Pagination Controls -->
			<div class="pagination-section">
				<div class="pagination-info">
					Página {{ currentPage + 1 }} de {{ totalPages }} | Total: {{ totalElements }} documento(s)
				</div>

				<div class="pagination-controls">
					<div class="page-size-selector">
						<label for="page-size" class="filter-label">Itens por página:</label>
						<select id="page-size" class="filter-select" [(ngModel)]="itemsPerPage" (change)="changeItemsPerPage(itemsPerPage)">
							<option [value]="10">10</option>
							<option [value]="20">20</option>
							<option [value]="30">30</option>
							<option [value]="50">50</option>
							<option [value]="100">100</option>
						</select>
					</div>

					<div class="page-navigation">
						<button class="btn-pagination" [disabled]="currentPage === 0" (click)="goToPreviousPage()" title="Página anterior">
							← Anterior
						</button>

						<div class="page-numbers">
							<button 
								*ngFor="let page of pageNumbers" 
								class="btn-page" 
								[class.active]="page === currentPage"
								(click)="goToPage(page)"
								title="Ir para página {{ page + 1 }}">
								{{ page + 1 }}
							</button>
						</div>

						<button class="btn-pagination" [disabled]="currentPage === totalPages - 1" (click)="goToNextPage()" title="Próxima página">
							Próxima →
						</button>
					</div>
				</div>
			</div>
		</div>

		<div class="documents-table-container">
			<table>
				<thead>
					<tr>
						<th>Tipo</th>
						<th>Título do Documento</th>
						<th>Empresa</th>
						<th>Data</th>
						<th class="actions-header">Ações</th>
					</tr>
				</thead>
				<tbody>
					<tr *ngFor="let d of documents; let i = index" class="doc-row" [attr.data-index]="i" [class.signed]="isDocumentSigned(d)">
						<td>
							{{ d.documentType || formatDocumentType(d.type) }}
						</td>
						<td>{{ d.title || d.name || '-' }}</td>
						<td>{{ d.companyName || d.company || d.clientName || '-' }}</td>
						<td>{{ formatDate(d.creationDate || d.inspectionDate || d.createdAt || d.date) }}</td>
					<td class="actions-cell">
						<button class="icon-btn" (click)="viewDocument(d)" title="Visualizar">
							<!-- Eye icon -->
							<svg class="icon-svg" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
								<path d="M2 12s4-8 10-8 10 8 10 8-4 8-10 8S2 12 2 12z" stroke="#374151" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round" fill="none"></path>
								<circle cx="12" cy="12" r="3" stroke="#374151" stroke-width="1.2" fill="none"></circle>
							</svg>
						</button>
						<button class="icon-btn" (click)="downloadDocument(d)" title="Baixar">
							<!-- Download icon -->
							<svg class="icon-svg" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
								<path d="M12 3v12" stroke="#374151" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
								<path d="M8 9l4 4 4-4" stroke="#374151" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
								<path d="M21 21H3" stroke="#374151" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
							</svg>
						</button>
						<!-- Edit icon - mostra quando documento NÃO está assinado -->
						<button *ngIf="!isDocumentSigned(d)" class="icon-btn" (click)="editDocument(d)" title="Editar documento">
							<svg class="icon-svg" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
								<path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" stroke="#374151" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
								<path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" stroke="#374151" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
							</svg>
						</button>
						<!-- Lock icon - mostra quando documento ESTÁ assinado -->
						<button *ngIf="isDocumentSigned(d)" class="icon-btn disabled" disabled title="Documento assinado não pode ser editado">
							<svg class="icon-svg" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
								<path d="M19 11H5a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2z" stroke="#f59e0b" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
								<path d="M7 11V7a5 5 0 0 1 10 0v4" stroke="#f59e0b" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
							</svg>
						</button>
						<!-- Delete icon -->
						<button class="icon-btn" (click)="deleteDocument(d)" title="Excluir">
							<svg class="icon-svg" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
								<path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6M10 11v6M14 11v6M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" stroke="#374151" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
							</svg>
						</button>
					</td>
					</tr>
					<tr *ngIf="!documents || documents.length === 0"><td colspan="5">Nenhum documento encontrado.</td></tr>
				</tbody>
			</table>
		</div>
	</div>
</section>

<!-- PDF Modal Overlay -->
<div class="pdf-modal-overlay" *ngIf="pdfModalOpen" (click)="closePdfModal()">
	<div class="pdf-modal" (click)="$event.stopPropagation()">
		<div class="pdf-modal-header"><h4>Visualizador de PDF</h4><button class="btn-close" (click)="closePdfModal()">Fechar</button></div>
		<div class="pdf-modal-body">
			<iframe *ngIf="pdfBlobUrl" [src]="pdfBlobUrl | safeUrl" width="100%" height="600px" title="Visualizador de PDF"></iframe>
			<p *ngIf="!pdfBlobUrl">Carregando...</p>
		</div>
	</div>
</div>