<div class="agenda-root">
  <div class="agenda-header">
    <h2>Agenda</h2>
    <div class="header-actions">
      <div class="filter-responsible">
        <div class="search-box">
          <span class="search-icon" aria-hidden="true">ðŸ”Ž</span>
          <input type="text" placeholder="Filtrar por responsÃ¡vel" [(ngModel)]="filterResponsibleInput" class="form-control search-input" aria-label="Filtrar por responsÃ¡vel" />
        </div>
        <button type="button" class="btn-filter" (click)="applyResponsibleFilter()" [disabled]="!filterResponsibleInput">Filtrar</button>
        <button type="button" class="btn-clear" (click)="clearResponsibleFilter()" [disabled]="!filterResponsibleInput">Limpar</button>
      </div>
  <div class="view-tabs" *ngIf="!isAdmin">
        <button 
          type="button" 
          class="tab-btn" 
          [class.active]="viewMode === 'calendar'"
          (click)="switchView('calendar')">
          ðŸ“… CalendÃ¡rio
        </button>
        <button 
          type="button" 
          class="tab-btn" 
          [class.active]="viewMode === 'list'"
          (click)="switchView('list')">
          ðŸ“‹ Listagem
        </button>
      </div>
      <button type="button" class="btn-primary" (click)="createNew()">+ Novo Evento</button>
      <button type="button" class="btn-secondary" (click)="loadEventos()">ðŸ”„ Atualizar</button>
    </div>
  </div>

  <div *ngIf="loading" class="loading-state">Carregando...</div>

  <!-- Vista: CalendÃ¡rio -->
  <div *ngIf="viewMode === 'calendar' && !isAdmin" class="calendar-container">
    <full-calendar #fullcalendar [options]="calendarOptions"></full-calendar>
  </div>

  <!-- Vista: Listagem -->
  <div *ngIf="viewMode === 'list'" class="list-container">
    <div *ngIf="eventos.length === 0" class="empty-state">
      <p>Nenhum evento encontrado. <button type="button" (click)="createNew()" class="btn-link">Criar novo</button></p>
    </div>
    <ul class="agenda-list" *ngIf="eventos.length > 0">
      <li *ngFor="let it of eventos; trackBy: trackByEventoId" class="agenda-item" [class]="'type-' + (it.type || 'EVENTO').toLowerCase()">
        <div class="left">
          <div class="title">{{ it.title }}</div>
          <div class="meta">
            {{ formatDateToBrazil(it.date) }}
            <span *ngIf="it.shift" class="shift-badge">â€¢ {{ it.shift === 'MANHA' ? 'ðŸŒ… ManhÃ£' : 'ðŸŒ† Tarde' }}</span>
            â€¢ <span class="type" [class]="'badge-' + (it.type || 'EVENTO').toLowerCase()">{{ it.type || 'EVENTO' }}</span>
          </div>
          <div class="responsible" *ngIf="it.responsibleName">ResponsÃ¡vel: {{ it.responsibleName }}</div>
          <div class="desc" *ngIf="it.description">{{ it.description }}</div>
          <div class="log" *ngIf="(it.type || 'EVENTO') === 'VISITA_REAGENDADA'">
            <small>Original: {{ it.originalVisitDate }} â€¢ Fonte: {{ it.sourceVisitId }}</small>
          </div>
        </div>
        <div class="actions" *ngIf="!isAdmin">
          <button type="button" class="icon-btn" title="Reagendar visita" *ngIf="(it.type || 'EVENTO') === 'VISITA'" (click)="editEvent(it)">
            <svg class="icon-svg" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="#374151" stroke-width="1.6" fill="none"></rect>
              <path d="M16 2v4M8 2v4" stroke="#374151" stroke-width="1.6" stroke-linecap="round"></path>
              <path d="M3 10h18" stroke="#374151" stroke-width="1.6"></path>
            </svg>
          </button>
          <button type="button" class="icon-btn" title="Re-reagendar visita" *ngIf="(it.type || 'EVENTO') === 'VISITA_REAGENDADA'" (click)="editEvent(it)">
            <svg class="icon-svg" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <path d="M1 4v6h6M23 20v-6h-6" stroke="#374151" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15" stroke="#374151" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          <button type="button" class="icon-btn" title="Editar evento" *ngIf="(it.type || 'EVENTO') === 'EVENTO'" (click)="editEvent(it)">
            <svg class="icon-svg" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" stroke="#374151" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" stroke="#374151" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          <button *ngIf="(it.type || 'EVENTO') === 'EVENTO' || (it.type || 'EVENTO') === 'VISITA_REAGENDADA'" type="button" class="icon-btn" title="Deletar evento" (click)="deleteEvent(it)">
            <svg class="icon-svg" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6M10 11v6M14 11v6M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" stroke="#374151" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
      </li>
    </ul>
  </div>

  <app-agenda-modal
    #agendaModal
    (confirmAction)="onModalConfirm($event)"
    (deleteAction)="onModalDelete($event)"
    (requestEdit)="onModalRequestEdit()"
  ></app-agenda-modal>
</div>