<section class="checklist-page page">
  <div class="container">
    <!-- Cabeçalho idêntico ao outro Novo Checklist -->
    <h1 class="page-title">Check List de Inspeção de Segurança do Trabalho</h1>
    <h2 class="page-subtitle">Baseado em Normas Regulamentadoras (NRs)</h2>

    <fieldset class="dados-relatorio">
      <legend>Dados do Checklist-NR</legend>
      <div class="form-group">
        <div class="fields">
          <div class="field-row">
            <label for="empresaClienteNR" class="field-label">Empresa Cliente:</label>
            <div class="field-input"><select id="empresaClienteNR" name="empresaClienteNR" class="form-control"></select></div>
          </div>

          <div class="field-row">
            <label for="empresaCnpjNR" class="field-label">CNPJ:</label>
            <div class="field-input"><input id="empresaCnpjNR" name="empresaCnpjNR" class="form-control" placeholder="00.000.000/0000-00"/></div>
          </div>

          <div class="field-row">
            <label for="empresaUnidadeNR" class="field-label">Unidade:</label>
            <div class="field-input"><select id="empresaUnidadeNR" name="empresaUnidadeNR" class="form-control" disabled></select></div>
          </div>

          <div class="field-row">
            <label for="empresaSetorNR" class="field-label">Setor:</label>
            <div class="field-input"><select id="empresaSetorNR" name="empresaSetorNR" class="form-control" disabled></select></div>
          </div>

          <div class="section-separator" aria-hidden="true"></div>

          <div class="field-row">
            <label for="reportTitleNR" class="field-label">Título do Documento:</label>
            <div class="field-input"><input id="reportTitleNR" class="form-control" placeholder="Ex: Inspeção NR - Setor A"/></div>
          </div>

          <div class="field-row">
            <label for="dataInspecaoNR" class="field-label">Data da Inspeção:</label>
            <div class="field-input"><input id="dataInspecaoNR" type="date" name="dataInspecaoNR" class="form-control" required/></div>
          </div>

          <div class="field-row">
            <label for="responsavelNR" class="field-label">Responsável pela Inspeção:</label>
            <div class="field-input"><input id="responsavelNR" name="responsavelNR" class="form-control" required/></div>
          </div>

          <div class="field-row">
            <label for="responsavelSiglaNR" class="field-label">Sigla do Conselho:</label>
            <div class="field-input"><input id="responsavelSiglaNR" name="responsavelSiglaNR" class="form-control"/></div>
          </div>

          <div class="field-row">
            <label for="responsavelRegistroNR" class="field-label">Registro do Conselho:</label>
            <div class="field-input"><input id="responsavelRegistroNR" name="responsavelRegistroNR" class="form-control"/></div>
          </div>

          <div class="field-row">
            <label for="responsavelEspecialidadeNR" class="field-label">Especialidade:</label>
            <div class="field-input"><input id="responsavelEspecialidadeNR" name="responsavelEspecialidadeNR" class="form-control" placeholder="Ex: Engenheiro de Segurança / Técnico de Segurança"/></div>
          </div>

          <div class="field-row">
            <label for="localInspecaoNR" class="field-label">Local da Inspeção:</label>
            <div class="field-input"><input id="localInspecaoNR" name="localInspecaoNR" class="form-control" placeholder="ex.: fabrica/escritório/banheiro" required/></div>
          </div>
        </div>
      </div>
    </fieldset>

    <form id="checklist-nr-form" (submit)="openSignatureModal($event)">
      <div class="legend-box" aria-hidden="false">
        <strong>Legenda:</strong>
        <span class="legend-item legend-c" aria-label="Conforme"><strong>C</strong> - Conforme</span>
        <span class="legend-item legend-nc" aria-label="Não Conforme"><strong>NC</strong> - Não Conforme</span>
        <span class="legend-item legend-na" aria-label="Não se Aplica"><strong>NA</strong> - Não se Aplica</span>
      </div>

      <ng-container *ngFor="let group of groupedSections">
        <div class="section-wrapper main-section">
          <h2 class="section-header main-section-title" (click)="toggleGroup(group.id,$event)" (keydown.enter)="toggleGroup(group.id,$event)" (keydown.space)="toggleGroup(group.id,$event)" role="button" tabindex="0">
            <span class="section-toggle">{{ group.title }} <span class="chev" [class.open]="isGroupOpen(group.id)" aria-hidden="true"></span></span>
          </h2>

          <ng-container *ngFor="let section of group.sections">
            <h3 class="section-header" (click)="toggleSection(section.__index,$event)" role="button" tabindex="0">
              <span class="section-toggle">{{ section.title }} <span class="chev" [class.open]="!section.collapsed" aria-hidden="true"></span></span>
              <span class="section-visual" *ngIf="getSectionVisualStatus(section) as vs">&nbsp;({{ vs }})</span>
            </h3>

            <div class="section-body" [attr.aria-hidden]="section.collapsed ? 'true':'false'" [class.collapsed]="section.collapsed">
              <div *ngFor="let item of section.items; let i = index" class="nr-item">
                <div class="item-row">
                  <div class="item-desc">{{ item.description }}</div>
                  <div class="item-controls">
                    <label class="pill pill-c"><input type="radio" name="status-{{section.__index}}-{{i}}" (change)="setItemStatus(section.__index,i,'CONFORME')" [checked]="item.status==='CONFORME'"/><span>C</span></label>
                    <label class="pill pill-nc"><input type="radio" name="status-{{section.__index}}-{{i}}" (change)="setItemStatus(section.__index,i,'NAO_CONFORME')" [checked]="item.status==='NAO_CONFORME'"/><span>NC</span></label>
                    <label class="pill pill-na"><input type="radio" name="status-{{section.__index}}-{{i}}" (change)="setItemStatus(section.__index,i,'NAO_APLICA')" [checked]="item.status==='NAO_APLICA'"/><span>NA</span></label>
                  </div>
                </div>
                <div class="item-justification" *ngIf="item.status === 'NAO_APLICA'">
                  <label>Justificativa:</label>
                  <input type="text" class="form-control" [value]="item.justification" (input)="setItemJustification(section.__index,i,$any($event.target).value)" placeholder="Informe a justificativa quando NA" />
                </div>
              </div>
            </div>
          </ng-container>
        </div>
      </ng-container>

        <div class="section-gap" aria-hidden="true"></div>

        <div class="form-group">
          <label for="anotacoesNR">Anotações:</label>
          <textarea id="anotacoesNR" class="form-control" rows="4"></textarea>
        </div>

        <div class="form-group">
          <label for="observationsNR">Observações Gerais:</label>
          <textarea id="observationsNR" class="form-control" rows="3"></textarea>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn-submit">Prosseguir para Assinatura</button>
        </div>

      </form>
  </div>
  <app-signature-modal #nrSignatureModal (confirmSignatures)="onSignaturesConfirmed($event)"></app-signature-modal>
</section>
