<section class="group-page">
	<div class="container">
		<h1 class="page-title">Gerenciamento de Inspe√ß√µes de Seguran√ßa</h1>

		<div class="action-buttons">
			<button class="action-btn action-checklist create-checklist" (click)="go('checklist')">
				<span class="icon">‚úÖ</span>
				<span class="text">
					<strong>Novo Checklist</strong>
					<small>Inspe√ß√£o estruturada</small>
				</span>
			</button>
			<button class="action-btn action-report create-report" (click)="go('report')">
				<span class="icon">üìù</span>
				<span class="text">
					<strong>Novo Relat√≥rio</strong>
					<small>Registro fotogr√°fico</small>
				</span>
			</button>
			<button class="action-btn action-aep create-aep" (click)="go('aep')">
				<span class="icon">üõ°Ô∏è</span>
				<span class="text">
					<strong>Novo AEP</strong>
					<small>Registro de AEP</small>
				</span>
			</button>
			<!-- Novo bot√£o solicitado: Novo Checklist (NR) colocado ao lado do Novo AEP -->
			<button class="action-btn action-checklist-nr create-checklist-nr" (click)="go('checklist-nr')">
				<span class="icon">üìã</span>
				<span class="text">
					<strong>Novo Checklist (NR)</strong>
					<small>Inspe√ß√£o NR</small>
				</span>
			</button>
		</div>

		<!-- Pr√≥ximos eventos / visitas (Agenda) -->
		<div class="upcoming-section">
			<h2>Pr√≥ximos eventos / visitas</h2>
			<div *ngIf="loadingUpcoming" class="small-muted">Carregando pr√≥ximos eventos...</div>
			<div *ngIf="!loadingUpcoming && (upcomingEventsAll.length===0)" class="small-muted">Nenhum evento agendado.</div>
			<ul *ngIf="!loadingUpcoming && pagedUpcoming.length" class="upcoming-list">
				<li *ngFor="let ev of pagedUpcoming" class="upcoming-item">
					<div class="ev-date">{{ formatDateToBrazil(ev.date) }}</div>
					<div class="ev-body">
						<div class="ev-title">{{ ev.title }} <span class="agenda-badge" [ngClass]="{ 'visita': ev.type==='VISITA', 'evento': ev.type==='EVENTO' }">{{ ev.type }}</span></div>
						<div class="ev-sub">{{ ev.unitName || '' }}<span *ngIf="ev.unitName && ev.sectorName"> ‚Ä¢ </span>{{ ev.sectorName || '' }}</div>
					</div>
				</li>
			</ul>
			<!-- Controles de pagina√ß√£o -->
			<div *ngIf="upcomingEventsAll.length > upcomingPageSize" class="upcoming-controls">
				<button class="btn btn-ghost" (click)="prevUpcomingPage()" [disabled]="upcomingPageIndex===0">Anterior</button>
				<div class="page-indicator">{{ upcomingPageStart }} - {{ upcomingPageEnd }} de {{ upcomingEventsAll.length }}</div>
				<button class="btn btn-ghost" (click)="nextUpcomingPage()" [disabled]="upcomingPageIndex >= upcomingMaxPageIndex">Pr√≥ximo</button>
			</div>
		</div>

		<div class="history-section">
			<h2>Hist√≥rico</h2>
			<div class="table-container">
				<table>
					<thead>
						<tr>
							<th>Tipo</th>
							<th>T√≠tulo</th>
							<th>Empresa</th>
							<th>Data</th>
							<th>A√ß√µes</th>
						</tr>
					</thead>
					<tbody>
						<tr *ngIf="loading">
							<td colspan="5">Carregando...</td>
						</tr>
						<tr *ngIf="!loading && history.length === 0">
							<td colspan="5">Nenhum hist√≥rico encontrado.</td>
						</tr>
						<tr *ngFor="let item of history" [attr.data-doc-id]="item.id || item.reportId">
							<td>{{ formatDocumentType(item.type || item.documentType) }}</td>
							<td>{{ item.title || item.type || 'Documento' }}</td>
							<td>{{ item.companyName || item.company || '' }}</td>
							<td>{{ formatDateToBrazil(item.inspectionDate || item.createdAt) }}</td>
							<td class="actions-cell">
								<button class="btn" (click)="downloadDoc(item)">Baixar</button>
								<button class="btn" (click)="viewDoc(item)">Visualizar</button>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
</section>
