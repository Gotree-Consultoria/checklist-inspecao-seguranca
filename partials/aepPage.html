<section class="aep-page">
  <div class="container">
    <h1 class="page-title">Avaliação Ergonômica Preliminar (AEP)</h1>
    <form id="aepForm" class="aep-form">
      <fieldset class="aep-header">
        <legend>Dados da Avaliação</legend>
        <div class="fields">
          <div class="field-row">
            <label for="aepCompany" class="field-label">Empresa Cliente:</label>
            <div class="field-input">
              <select id="aepCompany" name="aepCompany" class="form-select" required>
                <option value="">Carregando...</option>
              </select>
            </div>
          </div>

          <div class="field-row">
            <label for="aepCnpj" class="field-label">CNPJ:</label>
            <div class="field-input">
              <input type="text" id="aepCnpj" name="aepCnpj" class="form-control" readonly />
            </div>
          </div>

          <div class="field-row">
            <label for="aepUnit" class="field-label">Unidade (opcional)</label>
            <div class="field-input">
              <select id="aepUnit" name="aepUnit" class="form-select" disabled>
                <option value="">Selecione empresa</option>
              </select>
            </div>
          </div>

          <div class="field-row">
            <label for="aepSector" class="field-label">Setor (opcional)</label>
            <div class="field-input">
              <select id="aepSector" name="aepSector" class="form-select" disabled>
                <option value="">Selecione empresa</option>
              </select>
            </div>
          </div>

          <div class="section-separator" aria-hidden="true"></div>

          <div class="field-row">
            <label for="aepEvaluator" class="field-label">Responsável pela Avaliação</label>
            <div class="field-input">
              <input type="text" id="aepEvaluator" name="aepEvaluator" class="form-control" readonly placeholder="Carregando..." />
            </div>
          </div>

          <div class="field-row">
            <label for="aepSigla" class="field-label">Sigla do Conselho</label>
            <div class="field-input">
              <input type="text" id="aepSigla" name="aepSigla" class="form-control" readonly placeholder="—" />
            </div>
          </div>

          <div class="field-row">
            <label for="aepRegistro" class="field-label">Registro do Conselho</label>
            <div class="field-input">
              <input type="text" id="aepRegistro" name="aepRegistro" class="form-control" readonly placeholder="—" />
            </div>
          </div>

          <div class="field-row">
            <label for="aepDate" class="field-label">Data da Avaliação</label>
            <div class="field-input">
              <input type="date" id="aepDate" name="aepDate" class="form-control" required />
            </div>
          </div>

          <div class="field-row">
            <label for="aepFunction" class="field-label">Função Avaliada</label>
            <div class="field-input">
              <input type="text" id="aepFunction" name="aepFunction" class="form-control" placeholder="Ex: Operador de Produção" required />
            </div>
          </div>
        </div>
      </fieldset>

      <fieldset class="aep-risks">
        <legend>Riscos Identificados por Função</legend>
        <div class="table-wrapper">
          <table class="aep-table">
            <thead>
              <tr>
                <th class="col-sel">Sel</th>
                <th class="col-risk">Risco</th>
                <th>Fator de Risco</th>
              </tr>
            </thead>
            <tbody id="aepRisks">
              <tr><td colspan="3">Carregando fatores...</td></tr>
            </tbody>
          </table>
        </div>
      </fieldset>

      <div class="aep-actions">
        <button type="submit" class="btn-primary">Salvar AEP (Local)</button>
        <button type="button" id="aepClear" class="btn-secondary">Limpar</button>
      </div>
      <div id="aepMsg" class="feedback"></div>
    </form>
  </div>
</section>
<script>
// Placeholder de submissão simples (apenas front)
(function(){
  const form = document.getElementById('aepForm');
  if(form && !form.__bound){
    form.__bound = true;
    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      const sels = Array.from(form.querySelectorAll('input[name="risks"]:checked')).map(i=>i.value);
      const payload = {
        empresa: document.getElementById('aepCompany').value,
        avaliador: document.getElementById('aepEvaluator').value,
        data: document.getElementById('aepDate').value,
        funcao: document.getElementById('aepFunction').value,
        riscos: sels
      };
      localStorage.setItem('aepDraft', JSON.stringify(payload));
      const msg = document.getElementById('aepMsg');
      if(msg) msg.textContent = 'AEP salva localmente (draft).';
    });
    const clearBtn = document.getElementById('aepClear');
    if (clearBtn){
      clearBtn.addEventListener('click', ()=>{
        localStorage.removeItem('aepDraft');
        form.reset();
        const msg = document.getElementById('aepMsg');
        if(msg) msg.textContent = 'Formulário limpo.';
      })
    }
  }
})();
</script>
